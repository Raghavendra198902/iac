import { useState, useEffect } from 'react';
import { MainLayout } from '../components/layout';
import { API_URL } from '../config/api';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Server,
  Cpu,
  HardDrive,
  Activity,
  Database,
  Network,
  Clock,
  Zap,
  TrendingUp,
  TrendingDown,
  RefreshCw,
  AlertCircle,
  CheckCircle,
  Info,
  Thermometer,
  MemoryStick,
  Globe,
  Shield,
  Terminal,
  GitBranch,
  Package,
  Users,
  Box,
  Layers
} from 'lucide-react';

interface SystemMetrics {
  cpu: {
    usage: number;
    cores: number;
    model: string;
    temperature: number;
    speed: string;
  };
  memory: {
    total: number;
    used: number;
    free: number;
    percentage: number;
  };
  disk: {
    total: number;
    used: number;
    free: number;
    percentage: number;
  };
  network: {
    inbound: string;
    outbound: string;
    connections: number;
  };
  system: {
    hostname: string;
    platform: string;
    uptime: string;
    version: string;
  };
}

interface ServiceStatus {
  name: string;
  status: 'running' | 'stopped' | 'error';
  port: number;
  uptime: string;
  memory: string;
  cpu: string;
}

interface HistoryData {
  cpu: number[];
  memory: number[];
  disk: number[];
  network: number[];
}

export default function SystemInfo() {
  const [metrics, setMetrics] = useState<SystemMetrics | null>(null);
  const [services, setServices] = useState<ServiceStatus[]>([]);
  const [refreshing, setRefreshing] = useState(false);
  const [lastRefresh, setLastRefresh] = useState(new Date());
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [history, setHistory] = useState<HistoryData>({
    cpu: Array(30).fill(0),
    memory: Array(30).fill(0),
    disk: Array(30).fill(0),
    network: Array(30).fill(0)
  });

  const [autoRefresh, setAutoRefresh] = useState(true);
  const [refreshInterval, setRefreshInterval] = useState(5000);
  const [selectedView, setSelectedView] = useState<'overview' | 'detailed' | 'charts'>('overview');

  const fetchSystemMetrics = async () => {
    try {
      setRefreshing(true);
      setError(null);
      
      // Fetch real system metrics from backend API
      const response = await fetch(`${API_URL}/system/metrics`);
      
      if (!response.ok) {
        throw new Error(`Failed to fetch metrics: ${response.statusText}`);
      }
      
      const data = await response.json();
      setMetrics(data.metrics);
      setServices(data.services);
      setLastRefresh(new Date());
      
      // Update history with new data point
      // Calculate network usage percentage (connections / 1000 * 100, capped at 100)
      const networkUsage = Math.min(100, (data.metrics.network.connections / 10));
      
      setHistory(prev => ({
        cpu: [...prev.cpu.slice(1), data.metrics.cpu.usage],
        memory: [...prev.memory.slice(1), data.metrics.memory.percentage],
        disk: [...prev.disk.slice(1), data.metrics.disk.percentage],
        network: [...prev.network.slice(1), networkUsage]
      }));
    } catch (err) {
      console.error('Error fetching system metrics:', err);
      setError(err instanceof Error ? err.message : 'Failed to fetch system metrics');
      
      // Fallback to mock data if API fails
      setMetrics({
        cpu: {
          usage: 45,
          cores: navigator.hardwareConcurrency || 8,
          model: 'CPU Model (API Offline)',
          temperature: 58,
          speed: '3.8 GHz'
        },
        memory: {
          total: 32768,
          used: 18432,
          free: 14336,
          percentage: 56
        },
        disk: {
          total: 1024000,
          used: 716800,
          free: 307200,
          percentage: 70
        },
        network: {
          inbound: '125 MB/s',
          outbound: '85 MB/s',
          connections: 234
        },
        system: {
          hostname: window.location.hostname,
          platform: navigator.platform || 'Unknown Platform',
          uptime: '15 days, 7 hours, 23 minutes',
          version: 'v2.5.1'
        }
      });
      
      setServices([
        { name: 'API Gateway', status: 'running', port: 3001, uptime: '15d 7h', memory: '512 MB', cpu: '12%' },
        { name: 'Blueprint Service', status: 'running', port: 3002, uptime: '15d 7h', memory: '384 MB', cpu: '8%' },
        { name: 'IAC Generator', status: 'running', port: 3003, uptime: '15d 7h', memory: '256 MB', cpu: '5%' },
        { name: 'AI Engine', status: 'running', port: 3004, uptime: '15d 7h', memory: '1.2 GB', cpu: '25%' },
        { name: 'Automation Engine', status: 'running', port: 3005, uptime: '15d 7h', memory: '320 MB', cpu: '7%' },
        { name: 'CMDB Agent', status: 'running', port: 3006, uptime: '15d 7h', memory: '192 MB', cpu: '4%' },
        { name: 'Monitoring Service', status: 'running', port: 3007, uptime: '15d 7h', memory: '256 MB', cpu: '6%' },
        { name: 'Database (PostgreSQL)', status: 'running', port: 5432, uptime: '15d 7h', memory: '2.5 GB', cpu: '18%' },
        { name: 'Redis Cache', status: 'running', port: 6379, uptime: '15d 7h', memory: '128 MB', cpu: '3%' },
        { name: 'Message Queue', status: 'running', port: 5672, uptime: '15d 7h', memory: '256 MB', cpu: '5%' },
      ]);
    } finally {
      setRefreshing(false);
      setLoading(false);
    }
  };

  const refreshMetrics = () => {
    fetchSystemMetrics();
  };

  // Generate SVG path from history data
  const generatePath = (data: number[], maxValue: number = 100) => {
    const points = data.map((value, index) => {
      const x = (index / (data.length - 1)) * 100;
      const y = 40 - (value / maxValue) * 35; // Invert Y and scale to 0-35 range
      return `${x},${y}`;
    });
    return `M${points.join(' L')}`;
  };

  // Generate area path (for gradient fill)
  const generateAreaPath = (data: number[], maxValue: number = 100) => {
    const linePath = generatePath(data, maxValue);
    return `${linePath} L100,40 L0,40 Z`;
  };

  useEffect(() => {
    fetchSystemMetrics(); // Initial load
    
    if (!autoRefresh) return;
    
    const interval = setInterval(fetchSystemMetrics, refreshInterval);
    return () => clearInterval(interval);
  }, [autoRefresh, refreshInterval]);

  const formatBytes = (bytes: number) => {
    if (bytes >= 1024 * 1024) return `${(bytes / 1024 / 1024).toFixed(1)} GB`;
    return `${(bytes / 1024).toFixed(1)} MB`;
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'running': return 'text-green-600';
      case 'stopped': return 'text-gray-600';
      case 'error': return 'text-red-600';
      default: return 'text-gray-600';
    }
  };

  const getStatusBg = (status: string) => {
    switch (status) {
      case 'running': return 'bg-green-100 dark:bg-green-900/30';
      case 'stopped': return 'bg-gray-100 dark:bg-gray-900/30';
      case 'error': return 'bg-red-100 dark:bg-red-900/30';
      default: return 'bg-gray-100 dark:bg-gray-900/30';
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'running': return <CheckCircle className="w-4 h-4" />;
      case 'stopped': return <AlertCircle className="w-4 h-4" />;
      case 'error': return <AlertCircle className="w-4 h-4" />;
      default: return <Info className="w-4 h-4" />;
    }
  };

  return (
    <MainLayout>
      <div className="p-4 sm:p-6 lg:p-8">
        {/* Animated Background */}
        <div className="fixed inset-0 pointer-events-none overflow-hidden">
          <motion.div
            className="absolute -top-1/2 -left-1/2 w-full h-full bg-gradient-to-br from-blue-500/5 via-purple-500/5 to-transparent rounded-full blur-3xl"
            animate={{
              x: [0, 100, 0],
              y: [0, 50, 0],
              scale: [1, 1.2, 1],
            }}
            transition={{
              duration: 20,
              repeat: Infinity,
              ease: 'easeInOut',
            }}
          />
          <motion.div
            className="absolute -bottom-1/2 -right-1/2 w-full h-full bg-gradient-to-tl from-green-500/5 via-orange-500/5 to-transparent rounded-full blur-3xl"
            animate={{
              x: [0, -100, 0],
              y: [0, -50, 0],
              scale: [1, 1.1, 1],
            }}
            transition={{
              duration: 25,
              repeat: Infinity,
              ease: 'easeInOut',
            }}
          />
        </div>

        {/* Header */}
        <motion.div
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
          className="mb-6 relative z-10"
        >
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4">
            <div>
              <h1 className="text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3 mb-2">
                <div className="p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg">
                  <Server className="w-8 h-8 text-white" />
                </div>
                System Information
                {!error && (
                  <motion.span
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    className="text-xs sm:text-sm px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-full font-normal flex items-center gap-1.5"
                  >
                    <span className="relative flex h-2 w-2">
                      <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    Live
                  </motion.span>
                )}
                {error && (
                  <span className="text-xs sm:text-sm px-3 py-1 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full font-normal">
                    API Offline
                  </span>
                )}
              </h1>
              <p className="text-gray-600 dark:text-gray-400">
                Real-time server metrics and service status monitoring
              </p>
            </div>
            <div className="flex items-center gap-3">
              {/* Auto Refresh Toggle */}
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => setAutoRefresh(!autoRefresh)}
                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-300 ${
                  autoRefresh
                    ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border border-green-300 dark:border-green-700'
                    : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-400 border border-gray-300 dark:border-gray-700'
                }`}
              >
                <Activity className={`w-4 h-4 ${autoRefresh ? 'animate-pulse' : ''}`} />
                <span className="hidden sm:inline">{autoRefresh ? 'Auto' : 'Manual'}</span>
              </motion.button>

              {/* Refresh Interval Selector */}
              {autoRefresh && (
                <motion.select
                  initial={{ opacity: 0, x: -10 }}
                  animate={{ opacity: 1, x: 0 }}
                  value={refreshInterval}
                  onChange={(e) => setRefreshInterval(Number(e.target.value))}
                  className="px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value={1000}>1s</option>
                  <option value={5000}>5s</option>
                  <option value={10000}>10s</option>
                  <option value={30000}>30s</option>
                  <option value={60000}>1m</option>
                </motion.select>
              )}

              {/* View Selector */}
              <div className="flex items-center bg-gray-100 dark:bg-gray-800 rounded-lg p-1 border border-gray-200 dark:border-gray-700">
                {(['overview', 'detailed', 'charts'] as const).map((view) => (
                  <motion.button
                    key={view}
                    whileHover={{ scale: 1.05 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={() => setSelectedView(view)}
                    className={`px-3 py-1.5 rounded-md text-xs font-medium transition-all duration-300 ${
                      selectedView === view
                        ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-sm'
                        : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
                    }`}
                  >
                    {view.charAt(0).toUpperCase() + view.slice(1)}
                  </motion.button>
                ))}
              </div>

              {/* Manual Refresh Button */}
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95, rotate: 180 }}
                onClick={refreshMetrics}
                disabled={refreshing}
                className="flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-300 disabled:opacity-50 shadow-lg hover:shadow-xl"
              >
                <RefreshCw className={`w-5 h-5 ${refreshing ? 'animate-spin' : ''}`} />
                <span className="hidden sm:inline">Refresh</span>
              </motion.button>
            </div>
          </div>
          <div className="flex items-center justify-between text-sm">
            <div className="text-gray-500 dark:text-gray-400">
              Last updated: {lastRefresh.toLocaleTimeString()}
            </div>
            <div className="flex items-center gap-4">
              <div className="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                <Clock className="w-4 h-4" />
                <span>Uptime: {metrics?.system.uptime || 'N/A'}</span>
              </div>
              <div className="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                <Terminal className="w-4 h-4" />
                <span>{metrics?.system.platform || 'N/A'}</span>
              </div>
            </div>
          </div>
        </motion.div>

        {/* Loading State */}
        {loading && !metrics && (
          <div className="flex items-center justify-center py-20">
            <div className="text-center">
              <div className="animate-spin rounded-full h-12 w-12 border-4 border-gray-200 dark:border-gray-700 border-t-blue-600 mx-auto mb-4"></div>
              <p className="text-gray-600 dark:text-gray-400">Loading system metrics...</p>
            </div>
          </div>
        )}

        {/* Content */}
        <AnimatePresence mode="wait">
          {metrics && (
            <motion.div
              key="content"
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              transition={{ duration: 0.3 }}
            >
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 relative z-10">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 relative z-10">
              {/* CPU Card */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: 0 }}
                whileHover={{ scale: 1.02, y: -5 }}
                className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl rounded-xl p-4 sm:p-6 border border-gray-200 dark:border-gray-700 hover:shadow-2xl hover:shadow-blue-500/20 transition-all duration-300 group relative overflow-hidden"
              >
                <div className="absolute inset-0 bg-gradient-to-br from-blue-500/5 via-transparent to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-500/10 to-transparent rounded-full blur-2xl transform translate-x-16 -translate-y-16 group-hover:scale-150 transition-transform duration-700"></div>
                <div className="relative z-10">
                  <div className="flex items-center justify-between mb-4">
                    <motion.div 
                      whileHover={{ rotate: 360 }}
                      transition={{ duration: 0.6 }}
                      className="p-3 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg transform group-hover:scale-110 transition-all duration-300"
                    >
                      <Cpu className="w-6 h-6 text-white" />
                    </motion.div>
                    <div className="text-right">
                      <motion.div 
                        key={metrics.cpu.usage}
                        initial={{ scale: 1.2, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        className="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent"
                      >
                        {metrics.cpu.usage.toFixed(1)}%
                      </motion.div>
                      <div className="text-xs text-gray-500 flex items-center gap-1 justify-end">
                        <Thermometer className="w-3 h-3" />
                        {metrics.cpu.temperature.toFixed(0)}°C
                      </div>
                    </div>
                  </div>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between items-center">
                      <span className="text-gray-600 dark:text-gray-400 flex items-center gap-1">
                        <Layers className="w-3 h-3" />
                        Cores
                      </span>
                      <span className="font-medium text-gray-900 dark:text-white px-2 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">{metrics.cpu.cores}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-gray-600 dark:text-gray-400 flex items-center gap-1">
                        <Zap className="w-3 h-3" />
                        Speed
                      </span>
                      <span className="font-medium text-gray-900 dark:text-white px-2 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">{metrics.cpu.speed}</span>
                    </div>
                  </div>
                  <div className="mt-3 h-16 relative">
                    <svg className="w-full h-full" viewBox="0 0 100 40" preserveAspectRatio="none">
                      <defs>
                        <linearGradient id="cpuGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                          <stop offset="0%" stopColor="#3b82f6" stopOpacity="0.4" />
                          <stop offset="100%" stopColor="#3b82f6" stopOpacity="0.05" />
                        </linearGradient>
                        <filter id="glow">
                          <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                          <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                          </feMerge>
                        </filter>
                      </defs>
                      <line x1="0" y1="13.75" x2="100" y2="13.75" stroke="#ef4444" strokeWidth="0.5" strokeDasharray="2,2" opacity="0.4" />
                      <text x="98" y="13" fontSize="2.5" fill="#ef4444" textAnchor="end" opacity="0.6">75%</text>
                      <path d={generateAreaPath(history.cpu)} fill="url(#cpuGradient)" className="opacity-60" />
                      <path d={generatePath(history.cpu)} fill="none" stroke="#3b82f6" strokeWidth="2" filter="url(#glow)" className="drop-shadow-lg" />
                    </svg>
                  </div>
                </div>
              </motion.div>

              {/* Memory Card */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: 0.1 }}
                whileHover={{ scale: 1.02, y: -5 }}
                className="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-200 dark:border-gray-700 hover:shadow-2xl hover:shadow-purple-500/20 transition-all duration-300 group relative overflow-hidden"
              >
                <div className="absolute inset-0 bg-gradient-to-br from-purple-500/5 via-transparent to-pink-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div className="relative z-10">
                  <div className="flex items-center justify-between mb-4">
                    <div className="p-3 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg transform group-hover:scale-110 group-hover:rotate-6 transition-all duration-300">
                      <MemoryStick className="w-6 h-6 text-white" />
                    </div>
                    <div className="text-right">
                      <div className="text-2xl font-bold text-gray-900 dark:text-white">{metrics.memory.percentage}%</div>
                      <div className="text-xs text-gray-500">Memory Usage</div>
                    </div>
                  </div>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Used</span>
                      <span className="font-medium text-gray-900 dark:text-white">{formatBytes(metrics.memory.used)}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Total</span>
                      <span className="font-medium text-gray-900 dark:text-white">{formatBytes(metrics.memory.total)}</span>
                    </div>
                  </div>
                  <div className="mt-3 h-16 relative">
                    <svg className="w-full h-full" viewBox="0 0 100 40" preserveAspectRatio="none">
                      <defs>
                        <linearGradient id="memGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                          <stop offset="0%" stopColor="#a855f7" stopOpacity="0.3" />
                          <stop offset="100%" stopColor="#a855f7" stopOpacity="0" />
                        </linearGradient>
                      </defs>
                      {/* 75% Threshold Line */}
                      <line
                        x1="0"
                        y1="13.75"
                        x2="100"
                        y2="13.75"
                        stroke="#ef4444"
                        strokeWidth="1"
                        strokeDasharray="2,2"
                        opacity="0.6"
                      />
                      <text
                        x="98"
                        y="13"
                        fontSize="3"
                        fill="#ef4444"
                        textAnchor="end"
                        opacity="0.8"
                      >
                        75%
                      </text>
                      <path
                        d={generateAreaPath(history.memory)}
                        fill="url(#memGradient)"
                        className="opacity-50"
                      />
                      <path
                        d={generatePath(history.memory)}
                        fill="none"
                        stroke="#a855f7"
                        strokeWidth="2"
                        className="drop-shadow-lg"
                      />
                    </svg>
                  </div>
                </div>
              </motion.div>

              {/* Disk Card */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: 0.2 }}
                whileHover={{ scale: 1.02, y: -5 }}
                className="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-200 dark:border-gray-700 hover:shadow-2xl hover:shadow-green-500/20 transition-all duration-300 group relative overflow-hidden"
              >
                <div className="absolute inset-0 bg-gradient-to-br from-green-500/5 via-transparent to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div className="relative z-10">
                  <div className="flex items-center justify-between mb-4">
                    <div className="p-3 bg-gradient-to-br from-green-500 to-green-600 rounded-lg transform group-hover:scale-110 group-hover:rotate-6 transition-all duration-300">
                      <HardDrive className="w-6 h-6 text-white" />
                    </div>
                    <div className="text-right">
                      <div className="text-2xl font-bold text-gray-900 dark:text-white">{metrics.disk.percentage}%</div>
                      <div className="text-xs text-gray-500">Disk Usage</div>
                    </div>
                  </div>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Used</span>
                      <span className="font-medium text-gray-900 dark:text-white">{formatBytes(metrics.disk.used)}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Total</span>
                      <span className="font-medium text-gray-900 dark:text-white">{formatBytes(metrics.disk.total)}</span>
                    </div>
                  </div>
                  <div className="mt-3 h-16 relative">
                    <svg className="w-full h-full" viewBox="0 0 100 40" preserveAspectRatio="none">
                      <defs>
                        <linearGradient id="diskGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                          <stop offset="0%" stopColor="#22c55e" stopOpacity="0.3" />
                          <stop offset="100%" stopColor="#22c55e" stopOpacity="0" />
                        </linearGradient>
                      </defs>
                      {/* 75% Threshold Line */}
                      <line
                        x1="0"
                        y1="13.75"
                        x2="100"
                        y2="13.75"
                        stroke="#ef4444"
                        strokeWidth="1"
                        strokeDasharray="2,2"
                        opacity="0.6"
                      />
                      <text
                        x="98"
                        y="13"
                        fontSize="3"
                        fill="#ef4444"
                        textAnchor="end"
                        opacity="0.8"
                      >
                        75%
                      </text>
                      <path
                        d={generateAreaPath(history.disk)}
                        fill="url(#diskGradient)"
                        className="opacity-50"
                      />
                      <path
                        d={generatePath(history.disk)}
                        fill="none"
                        stroke="#22c55e"
                        strokeWidth="2"
                        className="drop-shadow-lg"
                      />
                    </svg>
                  </div>
                </div>
              </motion.div>

              {/* Network Card */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: 0.3 }}
                whileHover={{ scale: 1.02, y: -5 }}
                className="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-200 dark:border-gray-700 hover:shadow-2xl hover:shadow-orange-500/20 transition-all duration-300 group relative overflow-hidden"
              >
                <div className="absolute inset-0 bg-gradient-to-br from-orange-500/5 via-transparent to-yellow-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div className="relative z-10">
                  <div className="flex items-center justify-between mb-4">
                    <div className="p-3 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg transform group-hover:scale-110 group-hover:rotate-6 transition-all duration-300">
                      <Network className="w-6 h-6 text-white" />
                    </div>
                    <div className="text-right">
                      <div className="text-lg font-bold text-gray-900 dark:text-white">{metrics.network.connections}</div>
                      <div className="text-xs text-gray-500">Connections</div>
                    </div>
                  </div>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between items-center">
                      <span className="text-gray-600 dark:text-gray-400 flex items-center gap-1">
                        <TrendingDown className="w-3 h-3" /> In
                      </span>
                      <span className="font-medium text-gray-900 dark:text-white">{metrics.network.inbound}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-gray-600 dark:text-gray-400 flex items-center gap-1">
                        <TrendingUp className="w-3 h-3" /> Out
                      </span>
                      <span className="font-medium text-gray-900 dark:text-white">{metrics.network.outbound}</span>
                    </div>
                  </div>
                  <div className="mt-3 h-16 relative">
                    <svg className="w-full h-full" viewBox="0 0 100 40" preserveAspectRatio="none">
                      <defs>
                        <linearGradient id="networkGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                          <stop offset="0%" stopColor="#f97316" stopOpacity="0.3" />
                          <stop offset="100%" stopColor="#f97316" stopOpacity="0" />
                        </linearGradient>
                      </defs>
                      {/* 75% Threshold Line */}
                      <line
                        x1="0"
                        y1="13.75"
                        x2="100"
                        y2="13.75"
                        stroke="#ef4444"
                        strokeWidth="1"
                        strokeDasharray="2,2"
                        opacity="0.6"
                      />
                      <text
                        x="98"
                        y="13"
                        fontSize="3"
                        fill="#ef4444"
                        textAnchor="end"
                        opacity="0.8"
                      >
                        75%
                      </text>
                      <path
                        d={generateAreaPath(history.network)}
                        fill="url(#networkGradient)"
                        className="opacity-50"
                      />
                      <path
                        d={generatePath(history.network)}
                        fill="none"
                        stroke="#f97316"
                        strokeWidth="2"
                        className="drop-shadow-lg"
                      />
                    </svg>
                  </div>
                </div>
              </motion.div>
            </div>

            {/* System Details */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-8 relative z-10">
              {/* System Info */}
              <motion.div
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ duration: 0.5, delay: 0.4 }}
                whileHover={{ scale: 1.01, y: -4 }}
                className="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300"
              >
                <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                  <Info className="w-5 h-5 text-blue-600" />
                  System Details
                </h3>
                <div className="space-y-3">
                  <div className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <Globe className="w-5 h-5 text-gray-600 dark:text-gray-400" />
                      <span className="text-gray-700 dark:text-gray-300">Hostname</span>
                    </div>
                    <span className="font-mono text-sm text-gray-900 dark:text-white">{metrics.system.hostname}</span>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <Terminal className="w-5 h-5 text-gray-600 dark:text-gray-400" />
                      <span className="text-gray-700 dark:text-gray-300">Platform</span>
                    </div>
                    <span className="font-mono text-sm text-gray-900 dark:text-white">{metrics.system.platform}</span>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <Clock className="w-5 h-5 text-gray-600 dark:text-gray-400" />
                      <span className="text-gray-700 dark:text-gray-300">Uptime</span>
                    </div>
                    <span className="font-mono text-sm text-gray-900 dark:text-white">{metrics.system.uptime}</span>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <GitBranch className="w-5 h-5 text-gray-600 dark:text-gray-400" />
                      <span className="text-gray-700 dark:text-gray-300">Version</span>
                    </div>
                    <span className="font-mono text-sm text-gray-900 dark:text-white">{metrics.system.version}</span>
                  </div>
                </div>
              </motion.div>

              {/* CPU Details */}
              <motion.div
                initial={{ opacity: 0, x: 20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ duration: 0.5, delay: 0.5 }}
                whileHover={{ scale: 1.01, y: -4 }}
                className="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300"
              >
                <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                  <Cpu className="w-5 h-5 text-blue-600" />
                  Processor Details
                </h3>
                <div className="space-y-3">
                  <div className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <Box className="w-5 h-5 text-gray-600 dark:text-gray-400" />
                      <span className="text-gray-700 dark:text-gray-300">Model</span>
                    </div>
                    <span className="font-mono text-sm text-gray-900 dark:text-white">{metrics.cpu.model}</span>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <Layers className="w-5 h-5 text-gray-600 dark:text-gray-400" />
                      <span className="text-gray-700 dark:text-gray-300">Cores</span>
                    </div>
                    <span className="font-mono text-sm text-gray-900 dark:text-white">{metrics.cpu.cores} cores</span>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <Zap className="w-5 h-5 text-gray-600 dark:text-gray-400" />
                      <span className="text-gray-700 dark:text-gray-300">Speed</span>
                    </div>
                    <span className="font-mono text-sm text-gray-900 dark:text-white">{metrics.cpu.speed}</span>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <Thermometer className="w-5 h-5 text-gray-600 dark:text-gray-400" />
                      <span className="text-gray-700 dark:text-gray-300">Temperature</span>
                    </div>
                    <span className="font-mono text-sm text-gray-900 dark:text-white">{metrics.cpu.temperature.toFixed(1)}°C</span>
                  </div>
                </div>
              </motion.div>
            </div>

            {/* Services Status */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.5, delay: 0.6 }}
              className="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 relative z-10"
            >
              <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                <Activity className="w-5 h-5 text-blue-600" />
                Running Services
              </h3>
              <div className="overflow-x-auto -mx-4 sm:mx-0">
          <table className="w-full">
            <thead>
              <tr className="border-b border-gray-200 dark:border-gray-700">
                <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">Service</th>
                <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">Status</th>
                <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">Port</th>
                <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">Uptime</th>
                <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">Memory</th>
                <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">CPU</th>
              </tr>
            </thead>
            <tbody>
              {services.map((service, index) => (
                <tr 
                  key={index} 
                  className="border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors"
                  style={{ animationDelay: `${index * 0.05}s` }}
                >
                  <td className="py-3 px-4">
                    <div className="flex items-center gap-2">
                      <Server className="w-4 h-4 text-gray-600 dark:text-gray-400" />
                      <span className="text-sm font-medium text-gray-900 dark:text-white">{service.name}</span>
                    </div>
                  </td>
                  <td className="py-3 px-4">
                    <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${getStatusBg(service.status)} ${getStatusColor(service.status)}`}>
                      {getStatusIcon(service.status)}
                      {service.status}
                    </span>
                  </td>
                  <td className="py-3 px-4">
                    <span className="text-sm font-mono text-gray-900 dark:text-white">{service.port}</span>
                  </td>
                  <td className="py-3 px-4">
                    <span className="text-sm text-gray-700 dark:text-gray-300">{service.uptime}</span>
                  </td>
                  <td className="py-3 px-4">
                    <span className="text-sm text-gray-700 dark:text-gray-300">{service.memory}</span>
                  </td>
                  <td className="py-3 px-4">
                    <span className="text-sm text-gray-700 dark:text-gray-300">{service.cpu}</span>
                  </td>
                </tr>
              ))}
            </tbody>
              </table>
            </div>
            </motion.div>
          </motion.div>
        )}
        </AnimatePresence>
      </div>
    </MainLayout>
  );
}
